document.addEventListener('DOMContentLoaded',function() {initNavbar();window.addEventListener('popstate',function() {setActiveNavItem();});document.addEventListener('navigation:complete',function() {setActiveNavItem();});const originalPushState = history.pushState;if (originalPushState) {history.pushState = function() {originalPushState.apply(this,arguments);setActiveNavItem();};}});function initNavbar() {initMobileDropdowns();initSearchToggle();setActiveNavItem();enhanceAccessibility();enhanceKeyboardNavigation();initAriaLiveRegions();handleResponsiveBehavior();initScrollEffect();}function initMobileDropdowns() {const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;const dropdownToggles = document.querySelectorAll('.dropdown-toggle');dropdownToggles.forEach(toggle => {toggle.addEventListener('click',function(e) {if (window.innerWidth < 768 || (isTouchDevice && window.innerWidth >= 768)) {e.preventDefault();e.stopPropagation();const dropdownMenu = this.nextElementSibling;if (dropdownMenu.classList.contains('show')) {dropdownMenu.classList.remove('show');this.setAttribute('aria-expanded','false');}else {const parentUl = this.closest('ul');if (parentUl) {parentUl.querySelectorAll('.dropdown-menu.show').forEach(menu => {if (menu !== dropdownMenu && menu.parentElement.parentElement === parentUl) {menu.classList.remove('show');const otherToggle = menu.previousElementSibling;if (otherToggle) {otherToggle.setAttribute('aria-expanded','false');}}});}dropdownMenu.classList.add('show');this.setAttribute('aria-expanded','true');setTimeout(() => {const firstItem = dropdownMenu.querySelector('a');if (firstItem) {firstItem.focus();}},100);}}});if (!isTouchDevice) {const dropdownParent = toggle.closest('.dropdown');if (dropdownParent && window.innerWidth >= 768) {let leaveTimeout;dropdownParent.addEventListener('mouseenter',function() {if (window.innerWidth >= 768) {const dropdownMenu = this.querySelector('.dropdown-menu');if (dropdownMenu) {clearTimeout(leaveTimeout);dropdownMenu.classList.add('show');toggle.setAttribute('aria-expanded','true');}}});dropdownParent.addEventListener('mouseleave',function() {if (window.innerWidth >= 768) {const dropdownMenu = this.querySelector('.dropdown-menu');if (dropdownMenu) {leaveTimeout = setTimeout(() => {dropdownMenu.classList.remove('show');toggle.setAttribute('aria-expanded','false');},300);}}});}}});const submenuToggles = document.querySelectorAll('.dropdown-submenu > .dropdown-item.dropdown-toggle');submenuToggles.forEach(toggle => {toggle.addEventListener('click',function(e) {e.preventDefault();e.stopPropagation();const submenu = this.nextElementSibling;if (submenu.classList.contains('show')) {submenu.classList.remove('show');this.setAttribute('aria-expanded','false');}else {const parentMenu = this.closest('.dropdown-menu');if (parentMenu) {parentMenu.querySelectorAll('.dropdown-submenu-menu.show').forEach(menu => {if (menu !== submenu) {menu.classList.remove('show');const otherToggle = menu.previousElementSibling;if (otherToggle) {otherToggle.setAttribute('aria-expanded','false');}}});}submenu.classList.add('show');this.setAttribute('aria-expanded','true');setTimeout(() => {const firstItem = submenu.querySelector('a');if (firstItem) {firstItem.focus();}},100);}});if (!isTouchDevice) {const submenuParent = toggle.closest('.dropdown-submenu');if (submenuParent) {let leaveTimeout;submenuParent.addEventListener('mouseenter',function() {if (window.innerWidth >= 768) {const submenu = this.querySelector('.dropdown-submenu-menu');if (submenu) {clearTimeout(leaveTimeout);submenu.classList.add('show');toggle.setAttribute('aria-expanded','true');}}});submenuParent.addEventListener('mouseleave',function() {if (window.innerWidth >= 768) {const submenu = this.querySelector('.dropdown-submenu-menu');if (submenu) {leaveTimeout = setTimeout(() => {submenu.classList.remove('show');toggle.setAttribute('aria-expanded','false');},300);}}});}}});document.addEventListener('click',function(e) {if (!e.target.closest('.dropdown')) {document.querySelectorAll('.dropdown-menu.show').forEach(menu => {menu.classList.remove('show');const toggle = menu.previousElementSibling;if (toggle) {toggle.setAttribute('aria-expanded','false');}});}});if (isTouchDevice) {const dropdowns = document.querySelectorAll('.navbar .dropdown,.navbar .dropdown-submenu');dropdowns.forEach(dropdown => {dropdown.touchCount = 0;dropdown.addEventListener('touchstart',function(e) {if (window.innerWidth >= 768) {const toggle = dropdown.querySelector('.dropdown-toggle') || dropdown.querySelector('.dropdown-item.dropdown-toggle');const menu = dropdown.querySelector('.dropdown-menu') || dropdown.querySelector('.dropdown-submenu-menu');if (toggle && menu && (e.target === toggle || toggle.contains(e.target))) {this.touchCount = (this.touchCount || 0) + 1;if (this.touchCount === 1) {e.preventDefault();e.stopPropagation();dropdowns.forEach(d => {if (d !== dropdown) {const dMenu = d.querySelector('.dropdown-menu') || d.querySelector('.dropdown-submenu-menu');const dToggle = d.querySelector('.dropdown-toggle') || d.querySelector('.dropdown-item.dropdown-toggle');if (dMenu && dMenu.classList.contains('show')) {dMenu.classList.remove('show');if (dToggle) {dToggle.setAttribute('aria-expanded','false');}}d.touchCount = 0;}});menu.classList.add('show');toggle.setAttribute('aria-expanded','true');toggle.classList.add('touch-active');setTimeout(() => {toggle.classList.remove('touch-active');},300);}else {this.touchCount = 0;if (toggle.getAttribute('href') && toggle.getAttribute('href') !== '#') {window.location.href = toggle.getAttribute('href');}}}else if (!e.target.closest('.dropdown-menu') && !e.target.closest('.dropdown-submenu-menu')) {dropdowns.forEach(d => {d.touchCount = 0;});}}});});document.addEventListener('touchstart',function(e) {if (!e.target.closest('.dropdown') && !e.target.closest('.dropdown-submenu')) {const dropdowns = document.querySelectorAll('.navbar .dropdown,.navbar .dropdown-submenu');dropdowns.forEach(d => {d.touchCount = 0;});}});}window.addEventListener('resize',debounce(function() {const wasMobile = window.innerWidth < 768;const isMobile = window.innerWidth < 768;if (wasMobile !== isMobile) {document.querySelectorAll('.dropdown-menu.show,.dropdown-submenu-menu.show').forEach(menu => {menu.classList.remove('show');const toggle = menu.previousElementSibling;if (toggle) {toggle.setAttribute('aria-expanded','false');}});document.querySelectorAll('.navbar .dropdown,.navbar .dropdown-submenu').forEach(d => {d.touchCount = 0;});}},250));}function initSearchToggle() {const searchToggle = document.querySelector('.search-toggle');if (searchToggle) {searchToggle.setAttribute('aria-expanded','false');if (!searchToggle.getAttribute('aria-label')) {searchToggle.setAttribute('aria-label','Toggle search form');}searchToggle.addEventListener('click',function(e) {e.preventDefault();const searchCollapse = document.querySelector('.search-collapse');if (searchCollapse) {if (searchCollapse.classList.contains('show')) {searchCollapse.classList.add('closing');setTimeout(() => {searchCollapse.classList.remove('show');searchCollapse.classList.remove('closing');searchToggle.setAttribute('aria-expanded','false');searchToggle.setAttribute('aria-label','Open search form');const toggleText = searchToggle.querySelector('span');if (toggleText) {toggleText.textContent = 'Search';}announceToScreenReader('Search form closed');},300);const searchIcon = searchToggle.querySelector('i');if (searchIcon) {searchIcon.classList.add('fa-flip');setTimeout(() => {searchIcon.classList.remove('fa-times');searchIcon.classList.add('fa-search');searchIcon.classList.remove('fa-flip');},150);}}else {searchCollapse.classList.add('show');searchToggle.setAttribute('aria-expanded','true');searchToggle.setAttribute('aria-label','Close search form');const toggleText = searchToggle.querySelector('span');if (toggleText) {toggleText.textContent = 'Close';}const searchInput = searchCollapse.querySelector('input[type="search"]');if (searchInput) {setTimeout(() => {searchInput.focus();},300);}const searchIcon = searchToggle.querySelector('i');if (searchIcon) {searchIcon.classList.add('fa-flip');setTimeout(() => {searchIcon.classList.remove('fa-search');searchIcon.classList.add('fa-times');searchIcon.classList.remove('fa-flip');},150);}announceToScreenReader('Search form opened');}}});document.addEventListener('keydown',function(e) {if (e.key === 'Escape') {const searchCollapse = document.querySelector('.search-collapse.show');if (searchCollapse) {searchCollapse.classList.add('closing');setTimeout(() => {searchCollapse.classList.remove('show');searchCollapse.classList.remove('closing');searchToggle.setAttribute('aria-expanded','false');searchToggle.setAttribute('aria-label','Open search form');const searchIcon = searchToggle.querySelector('i');if (searchIcon) {searchIcon.classList.remove('fa-times');searchIcon.classList.add('fa-search');}const toggleText = searchToggle.querySelector('span');if (toggleText) {toggleText.textContent = 'Search';}announceToScreenReader('Search form closed with escape key');},300);const searchIcon = searchToggle.querySelector('i');if (searchIcon) {searchIcon.classList.add('fa-flip');setTimeout(() => {searchIcon.classList.remove('fa-flip');},300);}setTimeout(() => {searchToggle.focus();},350);}}});document.addEventListener('click',function(e) {if (!e.target.closest('.search-collapse') && !e.target.closest('.search-toggle')) {const searchCollapse = document.querySelector('.search-collapse.show');if (searchCollapse) {searchCollapse.classList.add('closing');setTimeout(() => {searchCollapse.classList.remove('show');searchCollapse.classList.remove('closing');searchToggle.setAttribute('aria-expanded','false');searchToggle.setAttribute('aria-label','Open search form');const searchIcon = searchToggle.querySelector('i');if (searchIcon) {searchIcon.classList.remove('fa-times');searchIcon.classList.add('fa-search');}const toggleText = searchToggle.querySelector('span');if (toggleText) {toggleText.textContent = 'Search';}},300);const searchIcon = searchToggle.querySelector('i');if (searchIcon) {searchIcon.classList.add('fa-flip');setTimeout(() => {searchIcon.classList.remove('fa-flip');},300);}}}});window.addEventListener('resize',debounce(function() {const searchCollapse = document.querySelector('.search-collapse');if (window.innerWidth >= 768 && searchCollapse && searchCollapse.classList.contains('show')) {searchCollapse.classList.remove('show');searchCollapse.classList.remove('closing');searchToggle.setAttribute('aria-expanded','false');searchToggle.setAttribute('aria-label','Open search form');const searchIcon = searchToggle.querySelector('i');if (searchIcon) {searchIcon.classList.remove('fa-times');searchIcon.classList.add('fa-search');}const toggleText = searchToggle.querySelector('span');if (toggleText) {toggleText.textContent = 'Search';}}},250));if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {searchToggle.addEventListener('touchstart',function(e) {const ripple = document.createElement('span');ripple.classList.add('search-toggle-ripple');this.appendChild(ripple);const rect = this.getBoundingClientRect();const size = Math.max(rect.width,rect.height);ripple.style.width = ripple.style.height = `${size}px`;ripple.style.left = `${e.touches[0].clientX - rect.left - size/2}px`;ripple.style.top = `${e.touches[0].clientY - rect.top - size/2}px`;setTimeout(() => {ripple.remove();},600);});}}initDesktopSearch();initSearchFormValidation();}function initDesktopSearch() {const desktopSearchContainer = document.querySelector('.d-none.d-md-block .search-form');if (desktopSearchContainer) {const searchInput = desktopSearchContainer.querySelector('input[type="search"]');const searchButton = desktopSearchContainer.querySelector('button[type="submit"]');if (searchInput) {searchInput.addEventListener('focus',function() {desktopSearchContainer.classList.add('search-focused');if (searchButton) {const searchIcon = searchButton.querySelector('i');if (searchIcon) {searchIcon.classList.add('fa-beat');setTimeout(() => {searchIcon.classList.remove('fa-beat');},500);}}});searchInput.addEventListener('blur',function() {if (!this.value) {desktopSearchContainer.classList.remove('search-focused');}});if (searchButton) {searchButton.addEventListener('mouseenter',function() {const searchIcon = this.querySelector('i');if (searchIcon) {searchIcon.classList.add('fa-flip');setTimeout(() => {searchIcon.classList.remove('fa-flip');},500);}});searchButton.addEventListener('click',function() {this.classList.add('search-button-clicked');setTimeout(() => {this.classList.remove('search-button-clicked');},300);});}searchInput.addEventListener('input',function() {if (this.value) {this.classList.add('has-content');}else {this.classList.remove('has-content');}});}}}function initSearchFormValidation() {const searchForms = document.querySelectorAll('.search-form');searchForms.forEach(form => {form.addEventListener('submit',function(e) {const searchInput = this.querySelector('input[type="search"]');if (searchInput && !searchInput.value.trim()) {e.preventDefault();searchInput.classList.add('empty');searchInput.setAttribute('aria-invalid','true');searchInput.classList.add('search-shake');setTimeout(() => {searchInput.classList.remove('search-shake');},600);searchInput.focus();announceToScreenReader('Please enter a search term');setTimeout(() => {searchInput.classList.remove('empty');searchInput.removeAttribute('aria-invalid');},3000);}});});}function initAriaLiveRegions() {let navAnnouncer = document.getElementById('nav-announcer');if (!navAnnouncer) {navAnnouncer = document.createElement('div');navAnnouncer.id = 'nav-announcer';navAnnouncer.setAttribute('aria-live','polite');navAnnouncer.setAttribute('aria-atomic','true');navAnnouncer.className = 'sr-only';document.body.appendChild(navAnnouncer);}const navLinks = document.querySelectorAll('.navbar-nav .nav-link');navLinks.forEach(link => {link.addEventListener('click',function() {const linkText = this.textContent.trim();setTimeout(() => {announceToScreenReader(`Navigating to ${linkText}`);},100);});});const dropdownToggles = document.querySelectorAll('.dropdown-toggle');dropdownToggles.forEach(toggle => {toggle.addEventListener('click',function() {const isExpanded = this.getAttribute('aria-expanded') === 'true';const toggleText = this.textContent.trim();setTimeout(() => {announceToScreenReader(`${toggleText}menu ${isExpanded ? 'closed' :'opened'}`);},100);});});}function enhanceAccessibility() {const navbar = document.querySelector('.navbar');if (navbar && !navbar.getAttribute('aria-label')) {navbar.setAttribute('aria-label','Main navigation');}const dropdowns = document.querySelectorAll('.dropdown');dropdowns.forEach(dropdown => {const toggle = dropdown.querySelector('.dropdown-toggle');const menu = dropdown.querySelector('.dropdown-menu');if (toggle && menu) {if (!toggle.getAttribute('aria-haspopup')) {toggle.setAttribute('aria-haspopup','true');}if (!toggle.getAttribute('aria-expanded')) {toggle.setAttribute('aria-expanded','false');}if (!menu.getAttribute('role')) {menu.setAttribute('role','menu');}const items = menu.querySelectorAll('.dropdown-item');items.forEach(item => {if (!item.getAttribute('role')) {item.setAttribute('role','menuitem');}});}});const toggler = document.querySelector('.navbar-toggler');if (toggler) {if (!toggler.getAttribute('aria-label')) {toggler.setAttribute('aria-label','Toggle navigation menu');}toggler.addEventListener('click',function() {const isExpanded = this.getAttribute('aria-expanded') === 'true';this.setAttribute('aria-label',isExpanded ? 'Close navigation menu' :'Open navigation menu');});}const mainNav = document.querySelector('.navbar-nav');if (mainNav && !mainNav.getAttribute('role')) {mainNav.setAttribute('role','menubar');}const userNav = document.querySelector('.user-account-section');if (userNav && !userNav.getAttribute('aria-label')) {userNav.setAttribute('aria-label','User account menu');}const searchForm = document.querySelector('.search-form');if (searchForm) {const searchInput = searchForm.querySelector('input[type="search"]');const searchButton = searchForm.querySelector('button[type="submit"]');if (searchInput && !searchInput.getAttribute('aria-label')) {searchInput.setAttribute('aria-label','Search');}if (searchButton && !searchButton.getAttribute('aria-label')) {searchButton.setAttribute('aria-label','Submit search');}}}function enhanceKeyboardNavigation() {const dropdownToggles = document.querySelectorAll('.dropdown-toggle');dropdownToggles.forEach(toggle => {toggle.addEventListener('keydown',function(e) {if (e.key === 'Enter' || e.key === ' ') {e.preventDefault();this.click();}else if (e.key === 'ArrowDown') {e.preventDefault();const menu = this.nextElementSibling;if (menu && menu.classList.contains('dropdown-menu')) {menu.classList.add('show');this.setAttribute('aria-expanded','true');const firstItem = menu.querySelector('.dropdown-item');if (firstItem) {firstItem.focus();}}}});});const dropdownMenus = document.querySelectorAll('.dropdown-menu');dropdownMenus.forEach(menu => {const items = menu.querySelectorAll('.dropdown-item');items.forEach((item,index) => {item.addEventListener('keydown',function(e) {let nextIndex;switch (e.key) {case 'ArrowDown':e.preventDefault();nextIndex = (index + 1) % items.length;items[nextIndex].focus();break;case 'ArrowUp':e.preventDefault();nextIndex = index > 0 ? index - 1 :items.length - 1;items[nextIndex].focus();break;case 'Home':e.preventDefault();items[0].focus();break;case 'End':e.preventDefault();items[items.length - 1].focus();break;case 'Escape':e.preventDefault();menu.classList.remove('show');const toggle = menu.previousElementSibling;if (toggle) {toggle.setAttribute('aria-expanded','false');toggle.focus();}break;case 'Tab':menu.classList.remove('show');const toggleTab = menu.previousElementSibling;if (toggleTab) {toggleTab.setAttribute('aria-expanded','false');}break;}});});});const toggler = document.querySelector('.navbar-toggler');if (toggler) {toggler.addEventListener('keydown',function(e) {if (e.key === 'Enter' || e.key === ' ') {e.preventDefault();this.click();}});}const navbarCollapse = document.querySelector('.navbar-collapse');if (navbarCollapse) {navbarCollapse.addEventListener('shown.bs.collapse',function() {const firstLink = this.querySelector('.nav-link');if (firstLink) {firstLink.focus();}});navbarCollapse.addEventListener('hidden.bs.collapse',function() {if (toggler) {toggler.focus();}});}document.addEventListener('keydown',function(e) {if (e.key === 'Tab' && navbarCollapse && navbarCollapse.classList.contains('show')) {const focusableElements = navbarCollapse.querySelectorAll( 'a[href],button:not([disabled]),input:not([disabled]),select:not([disabled]),textarea:not([disabled]),[tabindex]:not([tabindex="-1"])' );const firstElement = focusableElements[0];const lastElement = focusableElements[focusableElements.length - 1];if (e.shiftKey) {if (document.activeElement === firstElement) {e.preventDefault();lastElement.focus();}}else {if (document.activeElement === lastElement) {e.preventDefault();firstElement.focus();}}}});}function announceToScreenReader(message) {let announcer = document.getElementById('sr-announcer');if (!announcer) {announcer = document.createElement('div');announcer.id = 'sr-announcer';announcer.setAttribute('aria-live','polite');announcer.setAttribute('aria-atomic','true');announcer.className = 'sr-only';document.body.appendChild(announcer);}announcer.textContent = '';setTimeout(() => {announcer.textContent = message;},100);setTimeout(() => {announcer.textContent = '';},3000);}function initDesktopSearch() {const desktopSearchContainer = document.querySelector('.d-none.d-md-block .search-form');if (desktopSearchContainer) {const searchInput = desktopSearchContainer.querySelector('input[type="search"]');const searchButton = desktopSearchContainer.querySelector('button[type="submit"]');if (searchInput) {searchInput.addEventListener('focus',function() {desktopSearchContainer.classList.add('search-focused');});searchInput.addEventListener('blur',function() {if (!this.value) {desktopSearchContainer.classList.remove('search-focused');}});if (searchButton) {searchButton.addEventListener('mouseenter',function() {const searchIcon = this.querySelector('i');if (searchIcon) {searchIcon.classList.add('fa-flip');setTimeout(() => {searchIcon.classList.remove('fa-flip');},500);}});}}}}function setActiveNavItem() {const currentPath = window.location.pathname;document.querySelectorAll('.navbar-nav .active,.navbar-nav .active-parent,.dropdown-item.active').forEach(el => {el.classList.remove('active','active-parent');});let activeItemFound = false;const dropdownItems = document.querySelectorAll('.dropdown-item:not(.dropdown-toggle)');dropdownItems.forEach(item => {const href = item.getAttribute('href');if (!href) {return;}if (href === currentPath || (href !== '/' && currentPath.startsWith(href)) || (href === '/' && currentPath === '/')) {item.classList.add('active');activeItemFound = true;const parentSubmenu = item.closest('.dropdown-submenu');if (parentSubmenu) {const parentToggle = parentSubmenu.querySelector('.dropdown-item.dropdown-toggle');if (parentToggle) {parentToggle.classList.add('active');parentSubmenu.classList.add('active');}}let parentDropdown = item.closest('.dropdown');while (parentDropdown) {parentDropdown.classList.add('active-parent');const navLink = parentDropdown.querySelector('.nav-link');if (navLink) {navLink.setAttribute('aria-current','page');}parentDropdown = parentDropdown.parentElement.closest('.dropdown');}}});if (!activeItemFound) {const navLinks = document.querySelectorAll('.navbar-nav .nav-link:not(.dropdown-toggle)');navLinks.forEach(link => {const href = link.getAttribute('href');if (!href) {return;}if (href === currentPath || (href !== '/' && currentPath.startsWith(href)) || (href === '/' && currentPath === '/')) {const navItem = link.closest('.nav-item');if (navItem) {navItem.classList.add('active');link.setAttribute('aria-current','page');}}});}const dropdownToggles = document.querySelectorAll('.nav-link.dropdown-toggle');dropdownToggles.forEach(toggle => {const href = toggle.getAttribute('href');if (!href || href === '#') {return;}if (href === currentPath) {const navItem = toggle.closest('.nav-item');if (navItem) {navItem.classList.add('active');toggle.setAttribute('aria-current','page');}}});}function handleResponsiveBehavior() {adjustForViewport();window.addEventListener('resize',debounce(function() {adjustForViewport();handleBreakpointChanges();},250));const navbarToggler = document.querySelector('.navbar-toggler');const navbarCollapse = document.querySelector('.navbar-collapse');if (navbarToggler && navbarCollapse) {navbarToggler.addEventListener('click',function() {this.classList.add('toggler-active');setTimeout(() => {this.classList.remove('toggler-active');},600);if (navbarCollapse.classList.contains('show')) {navbarCollapse.classList.add('closing');setTimeout(() => {navbarCollapse.classList.remove('closing');},350);}});navbarCollapse.addEventListener('show.bs.collapse',function() {this.style.willChange = 'height,opacity,transform';});navbarCollapse.addEventListener('shown.bs.collapse',function() {this.style.willChange = 'auto';});navbarCollapse.addEventListener('hide.bs.collapse',function() {this.style.willChange = 'height,opacity,transform';this.classList.add('closing');});navbarCollapse.addEventListener('hidden.bs.collapse',function() {this.style.willChange = 'auto';this.classList.remove('closing');});}}function adjustForViewport() {const viewportWidth = window.innerWidth;const body = document.body;body.classList.remove('viewport-xs','viewport-sm','viewport-md','viewport-lg','viewport-xl');if (viewportWidth < 576) {body.classList.add('viewport-xs');optimizeForMobile();}else if (viewportWidth < 768) {body.classList.add('viewport-sm');optimizeForSmallTablet();}else if (viewportWidth < 992) {body.classList.add('viewport-md');optimizeForTablet();}else if (viewportWidth < 1200) {body.classList.add('viewport-lg');optimizeForDesktop();}else {body.classList.add('viewport-xl');optimizeForLargeDesktop();}}function handleBreakpointChanges() {const currentViewport = getCurrentViewport();const previousViewport = document.body.getAttribute('data-previous-viewport');if (currentViewport !== previousViewport) {if ((previousViewport === 'mobile' && currentViewport === 'desktop') || (previousViewport === 'desktop' && currentViewport === 'mobile')) {resetNavigationStates();}document.body.setAttribute('data-previous-viewport',currentViewport);document.dispatchEvent(new CustomEvent('viewport:changed',{detail:{current:currentViewport,previous:previousViewport,width:window.innerWidth }}));}}function getCurrentViewport() {const width = window.innerWidth;if (width < 768) return 'mobile';if (width < 992) return 'tablet';return 'desktop';}function resetNavigationStates() {document.querySelectorAll('.dropdown-menu.show,.dropdown-submenu-menu.show').forEach(menu => {menu.classList.remove('show');const toggle = menu.previousElementSibling;if (toggle) {toggle.setAttribute('aria-expanded','false');}});const searchCollapse = document.querySelector('.search-collapse.show');if (searchCollapse) {searchCollapse.classList.remove('show','closing');const searchToggle = document.querySelector('.search-toggle');if (searchToggle) {searchToggle.setAttribute('aria-expanded','false');}}const navbarCollapse = document.querySelector('.navbar-collapse.show');if (navbarCollapse && window.innerWidth >= 768) {navbarCollapse.classList.remove('show','closing');const navbarToggler = document.querySelector('.navbar-toggler');if (navbarToggler) {navbarToggler.setAttribute('aria-expanded','false');}}}function optimizeForMobile() {const buttons = document.querySelectorAll('.btn');buttons.forEach(btn => {if (!btn.classList.contains('btn-sm') && !btn.classList.contains('btn-lg')) {btn.style.minHeight = '3rem';}});const formControls = document.querySelectorAll('.form-control');formControls.forEach(control => {control.style.minHeight = '3rem';});}function optimizeForSmallTablet() {const buttons = document.querySelectorAll('.btn');buttons.forEach(btn => {if (!btn.classList.contains('btn-sm') && !btn.classList.contains('btn-lg')) {btn.style.minHeight = '2.75rem';}});}function optimizeForTablet() {const buttons = document.querySelectorAll('.btn');buttons.forEach(btn => {btn.style.minHeight = '';});const formControls = document.querySelectorAll('.form-control');formControls.forEach(control => {control.style.minHeight = '';});}function optimizeForDesktop() {document.body.classList.add('desktop-mode');}function optimizeForLargeDesktop() {document.body.classList.add('desktop-mode','large-desktop');}function debounce(func,wait,immediate) {let timeout;return function executedFunction() {const context = this;const args = arguments;const later = function() {timeout = null;if (!immediate) func.apply(context,args);};const callNow = immediate && !timeout;clearTimeout(timeout);timeout = setTimeout(later,wait);if (callNow) func.apply(context,args);};}unce(function() {adjustForViewport();handleBreakpointTransitions();},250));initEnhancedMobileNavigation();initResponsiveFormOptimizations();}function initEnhancedMobileNavigation() {const navbarToggler = document.querySelector('.navbar-toggler');const navbarCollapse = document.querySelector('.navbar-collapse');if (navbarToggler && navbarCollapse) {navbarToggler.addEventListener('click',function(e) {e.preventDefault();const isExpanded = this.getAttribute('aria-expanded') === 'true';if (isExpanded) {navbarCollapse.style.height = navbarCollapse.scrollHeight + 'px';navbarCollapse.classList.add('collapsing');navbarCollapse.classList.remove('show');navbarCollapse.offsetHeight;navbarCollapse.style.height = '0px';setTimeout(() => {navbarCollapse.classList.remove('collapsing');navbarCollapse.style.height = '';this.setAttribute('aria-expanded','false');announceToScreenReader('Navigation menu closed');},350);}else {navbarCollapse.classList.add('collapsing');navbarCollapse.style.height = '0px';navbarCollapse.offsetHeight;navbarCollapse.style.height = navbarCollapse.scrollHeight + 'px';setTimeout(() => {navbarCollapse.classList.remove('collapsing');navbarCollapse.classList.add('show');navbarCollapse.style.height = '';this.setAttribute('aria-expanded','true');const firstNavLink = navbarCollapse.querySelector('.nav-link');if (firstNavLink) {firstNavLink.focus();}announceToScreenReader('Navigation menu opened');},350);}});const navLinks = navbarCollapse.querySelectorAll('.nav-link:not(.dropdown-toggle)');navLinks.forEach(link => {link.addEventListener('click',function() {if (window.innerWidth < 768 && navbarCollapse.classList.contains('show')) {navbarToggler.click();}});});if ('ontouchstart' in window) {let startY = 0;let startX = 0;let isScrolling = false;navbarCollapse.addEventListener('touchstart',function(e) {startY = e.touches[0].clientY;startX = e.touches[0].clientX;isScrolling = false;},{passive:true });navbarCollapse.addEventListener('touchmove',function(e) {if (!startY || !startX) return;const currentY = e.touches[0].clientY;const currentX = e.touches[0].clientX;const diffY = startY - currentY;const diffX = startX - currentX;if (Math.abs(diffY) > Math.abs(diffX)) {isScrolling = true;}if (!isScrolling && diffY > 50 && Math.abs(diffX) < 100) {if (navbarCollapse.classList.contains('show')) {navbarToggler.click();}}},{passive:true });navbarCollapse.addEventListener('touchend',function() {startY = 0;startX = 0;isScrolling = false;},{passive:true });}}}function initResponsiveFormOptimizations() {const formInputs = document.querySelectorAll('input,select,textarea');formInputs.forEach(input => {if (window.innerWidth <= 575) {if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {if (input.type === 'email' || input.type === 'tel' || input.type === 'url') {input.addEventListener('focus',function() {this.style.fontSize = '16px';});input.addEventListener('blur',function() {this.style.fontSize = '';});}}input.addEventListener('touchstart',function() {this.classList.add('touch-active');},{passive:true });input.addEventListener('touchend',function() {setTimeout(() => {this.classList.remove('touch-active');},150);},{passive:true });}});const buttons = document.querySelectorAll('.btn');buttons.forEach(button => {if (window.innerWidth <= 575) {const rect = button.getBoundingClientRect();if (rect.height < 44) {button.style.minHeight = '44px';button.style.display = 'flex';button.style.alignItems = 'center';button.style.justifyContent = 'center';}}});}function handleBreakpointTransitions() {const currentWidth = window.innerWidth;if (!window.previousBreakpoint) {window.previousBreakpoint = getBreakpoint(currentWidth);}const currentBreakpoint = getBreakpoint(currentWidth);if (window.previousBreakpoint !== currentBreakpoint) {if ((window.previousBreakpoint === 'xs' || window.previousBreakpoint === 'sm') && (currentBreakpoint === 'md' || currentBreakpoint === 'lg' || currentBreakpoint === 'xl')) {resetMobileNavigationState();}else if ((window.previousBreakpoint === 'md' || window.previousBreakpoint === 'lg' || window.previousBreakpoint === 'xl') && (currentBreakpoint === 'xs' || currentBreakpoint === 'sm')) {resetDesktopNavigationState();}updateFormOptimizations(currentBreakpoint);updateComponentLayouts(currentBreakpoint);if (window.location.search.includes('debug=true')) {announceToScreenReader(`Breakpoint changed to ${currentBreakpoint}`);}window.previousBreakpoint = currentBreakpoint;}}function getBreakpoint(width) {if (width < 576) return 'xs';if (width < 768) return 'sm';if (width < 992) return 'md';if (width < 1200) return 'lg';return 'xl';}function resetMobileNavigationState() {const navbarCollapse = document.querySelector('.navbar-collapse');const navbarToggler = document.querySelector('.navbar-toggler');if (navbarCollapse && navbarToggler) {navbarCollapse.classList.remove('show','collapsing');navbarCollapse.style.height = '';navbarToggler.setAttribute('aria-expanded','false');}document.querySelectorAll('.dropdown-menu.show,.dropdown-submenu-menu.show').forEach(menu => {menu.classList.remove('show');const toggle = menu.previousElementSibling;if (toggle) {toggle.setAttribute('aria-expanded','false');}});}function resetDesktopNavigationState() {document.querySelectorAll('.dropdown').forEach(dropdown => {dropdown.touchCount = 0;});}function updateFormOptimizations(breakpoint) {const forms = document.querySelectorAll('form');forms.forEach(form => {if (breakpoint === 'xs' || breakpoint === 'sm') {form.classList.add('form-mobile-optimized');const formRows = form.querySelectorAll('.form-row,.row');formRows.forEach(row => {row.classList.add('flex-mobile-column');});}else {form.classList.remove('form-mobile-optimized');const formRows = form.querySelectorAll('.form-row,.row');formRows.forEach(row => {row.classList.remove('flex-mobile-column');});}});}function updateComponentLayouts(breakpoint) {const cardDecks = document.querySelectorAll('.card-deck');cardDecks.forEach(deck => {if (breakpoint === 'xs' || breakpoint === 'sm') {deck.classList.add('flex-mobile-column');}else {deck.classList.remove('flex-mobile-column');}});const tables = document.querySelectorAll('.table');tables.forEach(table => {const wrapper = table.closest('.table-responsive');if (wrapper) {if (breakpoint === 'xs') {table.classList.add('table-stack');}else {table.classList.remove('table-stack');}}});const buttonGroups = document.querySelectorAll('.btn-group');buttonGroups.forEach(group => {if (breakpoint === 'xs') {group.classList.add('btn-group-vertical');group.classList.remove('btn-group');}else {group.classList.add('btn-group');group.classList.remove('btn-group-vertical');}});}function adjustForViewport() {const currentBreakpoint = getBreakpoint(window.innerWidth);const searchContainer = document.querySelector('.search-container');if (searchContainer) {if (currentBreakpoint === 'xs' || currentBreakpoint === 'sm') {const searchToggle = searchContainer.querySelector('.search-toggle');const searchForm = searchContainer.querySelector('.search-form');if (searchToggle) searchToggle.style.display = 'block';if (searchForm) searchForm.style.display = 'none';}else {const searchToggle = searchContainer.querySelector('.search-toggle');const searchForm = searchContainer.querySelector('.search-form');if (searchToggle) searchToggle.style.display = 'none';if (searchForm) searchForm.style.display = 'flex';}}const navItems = document.querySelectorAll('.navbar-nav .nav-item');navItems.forEach(item => {if (currentBreakpoint === 'md') {item.style.marginLeft = '0.25rem';item.style.marginRight = '0.25rem';}else {item.style.marginLeft = '';item.style.marginRight = '';}});const dropdownMenus = document.querySelectorAll('.dropdown-menu');dropdownMenus.forEach(menu => {if (currentBreakpoint === 'xs' || currentBreakpoint === 'sm') {menu.style.width = '100%';menu.style.left = '0';menu.style.right = '0';}else {menu.style.width = '';menu.style.left = '';menu.style.right = '';}});}on current viewport size */ function adjustForViewport() {const isMobile = window.innerWidth < 768;const navbar = document.querySelector('.navbar');if (navbar) {if (isMobile) {navbar.classList.add('navbar-mobile');navbar.classList.remove('navbar-desktop');}else {navbar.classList.add('navbar-desktop');navbar.classList.remove('navbar-mobile');document.querySelectorAll('.dropdown-menu.show').forEach(menu => {if (!menu.closest('.dropdown').matches(':hover')) {menu.classList.remove('show');}});const searchCollapse = document.querySelector('.search-collapse');if (searchCollapse) {searchCollapse.classList.remove('show');}}}}function enhanceAccessibility() {const dropdowns = document.querySelectorAll('.dropdown');dropdowns.forEach((dropdown,index) => {const toggle = dropdown.querySelector('.dropdown-toggle');const menu = dropdown.querySelector('.dropdown-menu');if (toggle && menu) {const toggleId = toggle.id || `navbar-dropdown-toggle-${index}`;const menuId = menu.id || `navbar-dropdown-menu-${index}`;if (!toggle.id) toggle.id = toggleId;if (!menu.id) menu.id = menuId;toggle.setAttribute('aria-expanded','false');toggle.setAttribute('aria-haspopup','true');toggle.setAttribute('aria-controls',menuId);menu.setAttribute('aria-labelledby',toggleId);toggle.addEventListener('click',function() {const expanded = menu.classList.contains('show');toggle.setAttribute('aria-expanded',expanded ? 'true' :'false');});}});const submenuDropdowns = document.querySelectorAll('.dropdown-submenu');submenuDropdowns.forEach((submenu,index) => {const toggle = submenu.querySelector('.dropdown-item.dropdown-toggle');const menu = submenu.querySelector('.dropdown-submenu-menu');if (toggle && menu) {const toggleId = toggle.id || `navbar-submenu-toggle-${index}`;const menuId = menu.id || `navbar-submenu-menu-${index}`;if (!toggle.id) toggle.id = toggleId;if (!menu.id) menu.id = menuId;toggle.setAttribute('aria-expanded','false');toggle.setAttribute('aria-haspopup','true');toggle.setAttribute('aria-controls',menuId);menu.setAttribute('aria-labelledby',toggleId);toggle.addEventListener('click',function() {const expanded = menu.classList.contains('show');toggle.setAttribute('aria-expanded',expanded ? 'true' :'false');});}});const interactiveElements = document.querySelectorAll('.navbar button,.navbar a');interactiveElements.forEach(el => {if (!el.getAttribute('tabindex')) {el.setAttribute('tabindex','0');}});enhanceKeyboardNavigation();}function enhanceKeyboardNavigation() {const dropdownToggles = document.querySelectorAll('.navbar-nav > .nav-item > .dropdown-toggle');dropdownToggles.forEach(toggle => {toggle.addEventListener('keydown',function(e) {if (e.key === 'Enter' || e.key === ' ') {e.preventDefault();const dropdownMenu = this.nextElementSibling;if (dropdownMenu) {const isExpanded = dropdownMenu.classList.contains('show');if (!isExpanded) {document.querySelectorAll('.dropdown-menu.show').forEach(menu => {menu.classList.remove('show');const otherToggle = menu.previousElementSibling;if (otherToggle) {otherToggle.setAttribute('aria-expanded','false');}});dropdownMenu.classList.add('show');this.setAttribute('aria-expanded','true');const firstItem = dropdownMenu.querySelector('a');if (firstItem) {setTimeout(() => {firstItem.focus();},100);}}else {dropdownMenu.classList.remove('show');this.setAttribute('aria-expanded','false');}}}if (e.key === 'ArrowDown') {e.preventDefault();const dropdownMenu = this.nextElementSibling;if (dropdownMenu) {dropdownMenu.classList.add('show');this.setAttribute('aria-expanded','true');const firstItem = dropdownMenu.querySelector('a');if (firstItem) {firstItem.focus();}}}});});const submenuToggles = document.querySelectorAll('.dropdown-submenu > .dropdown-item.dropdown-toggle');submenuToggles.forEach(toggle => {toggle.addEventListener('keydown',function(e) {if (e.key === 'Enter' || e.key === ' ' || e.key === 'ArrowRight') {e.preventDefault();const submenu = this.nextElementSibling;if (submenu) {const isExpanded = submenu.classList.contains('show');if (!isExpanded) {const parentMenu = this.closest('.dropdown-menu');if (parentMenu) {parentMenu.querySelectorAll('.dropdown-submenu-menu.show').forEach(menu => {if (menu !== submenu) {menu.classList.remove('show');const otherToggle = menu.previousElementSibling;if (otherToggle) {otherToggle.setAttribute('aria-expanded','false');}}});}submenu.classList.add('show');this.setAttribute('aria-expanded','true');const firstItem = submenu.querySelector('a');if (firstItem) {setTimeout(() => {firstItem.focus();},100);}}else if (e.key === 'ArrowRight') {const firstItem = submenu.querySelector('a');if (firstItem) {firstItem.focus();}}else {submenu.classList.remove('show');this.setAttribute('aria-expanded','false');}}}if (e.key === 'ArrowLeft') {e.preventDefault();const submenu = this.nextElementSibling;if (submenu && submenu.classList.contains('show')) {submenu.classList.remove('show');this.setAttribute('aria-expanded','false');}const parentMenu = this.closest('.dropdown-menu');if (parentMenu) {const parentItem = parentMenu.previousElementSibling;if (parentItem) {parentItem.focus();}}}});});const dropdownItems = document.querySelectorAll('.dropdown-menu a');dropdownItems.forEach(item => {item.addEventListener('keydown',function(e) {const parentMenu = this.closest('.dropdown-menu');const isSubmenuItem = this.closest('.dropdown-submenu-menu') !== null;if (e.key === 'ArrowDown') {e.preventDefault();const nextItem = this.parentNode.nextElementSibling;if (nextItem) {const link = nextItem.querySelector('a');if (link) {link.focus();}}}if (e.key === 'ArrowUp') {e.preventDefault();const prevItem = this.parentNode.previousElementSibling;if (prevItem) {const link = prevItem.querySelector('a');if (link) {link.focus();}}else {const toggle = parentMenu.previousElementSibling;if (toggle) {toggle.focus();}}}if (e.key === 'ArrowRight') {if (this.classList.contains('dropdown-toggle')) {e.preventDefault();const submenu = this.nextElementSibling;if (submenu) {submenu.classList.add('show');this.setAttribute('aria-expanded','true');const firstItem = submenu.querySelector('a');if (firstItem) {firstItem.focus();}}}}if (e.key === 'ArrowLeft' && isSubmenuItem) {e.preventDefault();const submenu = this.closest('.dropdown-submenu-menu');if (submenu) {submenu.classList.remove('show');const toggle = submenu.previousElementSibling;if (toggle) {toggle.setAttribute('aria-expanded','false');toggle.focus();}}}if (e.key === 'Escape') {e.preventDefault();if (isSubmenuItem) {const submenu = this.closest('.dropdown-submenu-menu');if (submenu) {submenu.classList.remove('show');const toggle = submenu.previousElementSibling;if (toggle) {toggle.setAttribute('aria-expanded','false');toggle.focus();}}}else {parentMenu.classList.remove('show');const toggle = parentMenu.previousElementSibling;if (toggle) {toggle.setAttribute('aria-expanded','false');toggle.focus();}}}});});}function initScrollEffect() {const navbar = document.querySelector('.navbar-custom');if (navbar) {checkScrollPosition();window.addEventListener('scroll',debounce(function() {checkScrollPosition();},100));function checkScrollPosition() {if (window.scrollY > 50) {navbar.classList.add('navbar-scrolled');}else {navbar.classList.remove('navbar-scrolled');}}}}function debounce(func,wait) {let timeout;return function() {const context = this;const args = arguments;clearTimeout(timeout);timeout = setTimeout(function() {func.apply(context,args);},wait);};}document.addEventListener('DOMContentLoaded',function() {initSearchFormSubmission();});function initSearchFormSubmission() {const searchForms = document.querySelectorAll('.search-form');searchForms.forEach(form => {form.addEventListener('submit',function(e) {const searchInput = form.querySelector('input[type="search"]');if (!searchInput || !searchInput.value.trim()) {e.preventDefault();searchInput.classList.add('shake-animation');setTimeout(() => {searchInput.classList.remove('shake-animation');},500);searchInput.focus();}else {if (typeof gtag === 'function') {gtag('event','search',{search_term:searchInput.value.trim() });}if (!window.searchResultsPageExists) {}}});});const currentPath = window.location.pathname;const searchContainer = document.querySelector('.search-container');const mobileSearchToggle = document.querySelector('.d-md-none .search-toggle');if (currentPath === '/login' || currentPath === '/register') {if (searchContainer) {searchContainer.style.display = 'none';}if (mobileSearchToggle) {mobileSearchToggle.style.display = 'none';}}}document.addEventListener('DOMContentLoaded',function() {const style = document.createElement('style');style.textContent = ` @keyframes shake {0%,100% {transform:translateX(0);}10%,30%,50%,70%,90% {transform:translateX(-5px);}20%,40%,60%,80% {transform:translateX(5px);}}.shake-animation {animation:shake 0.5s cubic-bezier(.36,.07,.19,.97) both;}`;document.head.appendChild(style);});function enhanceKeyboardNavigation() {const dropdownToggles = document.querySelectorAll('.dropdown-toggle');dropdownToggles.forEach(toggle => {toggle.addEventListener('keydown',function(e) {const dropdownMenu = this.nextElementSibling;if (e.key === 'ArrowDown' || e.key === 'Down') {e.preventDefault();if (!dropdownMenu.classList.contains('show')) {dropdownMenu.classList.add('show');this.setAttribute('aria-expanded','true');}const firstItem = dropdownMenu.querySelector('a');if (firstItem) {firstItem.focus();}}if (e.key === 'Escape') {if (dropdownMenu.classList.contains('show')) {dropdownMenu.classList.remove('show');this.setAttribute('aria-expanded','false');this.focus();}}if (e.key === ' ' || e.key === 'Enter') {e.preventDefault();if (dropdownMenu.classList.contains('show')) {dropdownMenu.classList.remove('show');this.setAttribute('aria-expanded','false');}else {dropdownMenu.classList.add('show');this.setAttribute('aria-expanded','true');setTimeout(() => {const firstItem = dropdownMenu.querySelector('a');if (firstItem) {firstItem.focus();}},100);}}});});const dropdownMenus = document.querySelectorAll('.dropdown-menu');dropdownMenus.forEach(menu => {const menuItems = menu.querySelectorAll('a.dropdown-item');menuItems.forEach((item,index) => {item.addEventListener('keydown',function(e) {if (e.key === 'ArrowDown' || e.key === 'Down') {e.preventDefault();if (index < menuItems.length - 1) {menuItems[index + 1].focus();}else {menuItems[0].focus();}}if (e.key === 'ArrowUp' || e.key === 'Up') {e.preventDefault();if (index > 0) {menuItems[index - 1].focus();}else {menuItems[menuItems.length - 1].focus();}}if (e.key === 'Escape') {e.preventDefault();const dropdown = item.closest('.dropdown');if (dropdown) {const toggle = dropdown.querySelector('.dropdown-toggle');const dropdownMenu = dropdown.querySelector('.dropdown-menu');if (toggle && dropdownMenu) {dropdownMenu.classList.remove('show');toggle.setAttribute('aria-expanded','false');toggle.focus();}}}if ((e.key === 'ArrowRight' || e.key === 'Right') && item.classList.contains('dropdown-toggle')) {e.preventDefault();const submenu = item.nextElementSibling;if (submenu && submenu.classList.contains('dropdown-submenu-menu')) {submenu.classList.add('show');item.setAttribute('aria-expanded','true');const firstSubmenuItem = submenu.querySelector('a');if (firstSubmenuItem) {firstSubmenuItem.focus();}}}if (e.key === 'ArrowLeft' || e.key === 'Left') {e.preventDefault();const submenu = item.closest('.dropdown-submenu-menu');if (submenu) {const parentToggle = submenu.previousElementSibling;if (parentToggle) {submenu.classList.remove('show');parentToggle.setAttribute('aria-expanded','false');parentToggle.focus();}}}if (e.key === 'Tab' && !e.shiftKey && index === menuItems.length - 1) {const dropdown = item.closest('.dropdown');if (dropdown) {setTimeout(() => {const dropdownMenu = dropdown.querySelector('.dropdown-menu');const toggle = dropdown.querySelector('.dropdown-toggle');if (dropdownMenu && !dropdownMenu.contains(document.activeElement) && document.activeElement !== toggle) {dropdownMenu.classList.remove('show');if (toggle) {toggle.setAttribute('aria-expanded','false');}}},10);}}if (e.key === 'Tab' && e.shiftKey && index === 0) {const dropdown = item.closest('.dropdown');if (dropdown) {setTimeout(() => {const dropdownMenu = dropdown.querySelector('.dropdown-menu');const toggle = dropdown.querySelector('.dropdown-toggle');if (dropdownMenu && !dropdownMenu.contains(document.activeElement) && document.activeElement !== toggle) {dropdownMenu.classList.remove('show');if (toggle) {toggle.setAttribute('aria-expanded','false');}}},10);}}});});});const searchToggle = document.querySelector('.search-toggle');if (searchToggle) {searchToggle.addEventListener('keydown',function(e) {if (e.key === ' ' || e.key === 'Enter') {e.preventDefault();this.click();}});}const mobileSearchCollapse = document.querySelector('.search-collapse');if (mobileSearchCollapse) {const searchInput = mobileSearchCollapse.querySelector('input[type="search"]');const searchButton = mobileSearchCollapse.querySelector('button[type="submit"]');if (searchInput && searchButton) {searchInput.addEventListener('keydown',function(e) {if (e.key === 'Tab' && e.shiftKey) {e.preventDefault();searchButton.focus();}});searchButton.addEventListener('keydown',function(e) {if (e.key === 'Tab' && !e.shiftKey) {e.preventDefault();searchInput.focus();}});}}addSkipToContentLink();}function addSkipToContentLink() {if (document.getElementById('skip-to-content')) {return;}const skipLink = document.createElement('a');skipLink.id = 'skip-to-content';skipLink.href = '#main-content';skipLink.textContent = 'Skip to main content';skipLink.className = 'skip-link';const style = document.createElement('style');style.textContent = ` .skip-link {position:absolute;top:-40px;left:0;background:#2FA4E7;color:white;padding:8px;z-index:100;transition:top 0.3s ease;}.skip-link:focus {top:0;outline:2px solid white;}`;document.head.appendChild(style);document.body.insertBefore(skipLink,document.body.firstChild);const mainContent = document.querySelector('main');if (mainContent && !mainContent.id) {mainContent.id = 'main-content';mainContent.setAttribute('tabindex','-1');}}function enhanceAccessibility() {document.querySelectorAll('.navbar-nav .active').forEach(item => {const link = item.querySelector('.nav-link');if (link) {link.setAttribute('aria-current','page');}});document.querySelectorAll('.navbar a,.navbar button').forEach(element => {if (!element.getAttribute('tabindex') && !element.hasAttribute('disabled')) {element.setAttribute('tabindex','0');}});document.querySelectorAll('.dropdown-menu').forEach(menu => {if (!menu.getAttribute('role')) {menu.setAttribute('role','menu');}menu.querySelectorAll('.dropdown-item').forEach(item => {if (!item.getAttribute('role')) {item.setAttribute('role','menuitem');}});});document.querySelectorAll('.dropdown-toggle').forEach(toggle => {if (!toggle.getAttribute('aria-haspopup')) {toggle.setAttribute('aria-haspopup','true');}if (!toggle.getAttribute('aria-expanded')) {toggle.setAttribute('aria-expanded','false');}});document.querySelectorAll('.dropdown').forEach(dropdown => {const toggle = dropdown.querySelector('.dropdown-toggle');const menu = dropdown.querySelector('.dropdown-menu');if (toggle && menu) {document.addEventListener('focusin',function(e) {if (menu.classList.contains('show') && !dropdown.contains(e.target)) {menu.classList.remove('show');toggle.setAttribute('aria-expanded','false');}});}});const liveRegion = document.createElement('div');liveRegion.id = 'navbar-live-region';liveRegion.className = 'sr-only';liveRegion.setAttribute('aria-live','polite');liveRegion.setAttribute('aria-atomic','true');document.body.appendChild(liveRegion);const focusStyle = document.createElement('style');focusStyle.textContent = ` .navbar a:focus,.navbar button:focus {outline:2px solid rgba(255,255,255,0.5);outline-offset:2px;}.dropdown-menu a:focus {outline:2px solid rgba(47,164,231,0.5);outline-offset:-2px;}@media (forced-colors:active) {.navbar a:focus,.navbar button:focus,.dropdown-menu a:focus {outline:2px solid CanvasText;}}`;document.head.appendChild(focusStyle);}function debounce(func,wait) {let timeout;return function() {const context = this;const args = arguments;clearTimeout(timeout);timeout = setTimeout(() => func.apply(context,args),wait);};}document.addEventListener('DOMContentLoaded',function() {let usingKeyboard = false;document.addEventListener('keydown',function(e) {if (e.key === 'Tab') {usingKeyboard = true;document.body.classList.add('keyboard-nav');}});document.addEventListener('mousedown',function() {usingKeyboard = false;document.body.classList.remove('keyboard-nav');});const trapFocusInModal = function(modal) {if (!modal) return;const focusableElements = modal.querySelectorAll( 'a[href],button,textarea,input[type="text"],input[type="search"],input[type="radio"],input[type="checkbox"],select' );if (focusableElements.length === 0) return;const firstElement = focusableElements[0];const lastElement = focusableElements[focusableElements.length - 1];modal.addEventListener('keydown',function(e) {if (e.key === 'Tab') {if (e.shiftKey && document.activeElement === firstElement) {e.preventDefault();lastElement.focus();}else if (!e.shiftKey && document.activeElement === lastElement) {e.preventDefault();firstElement.focus();}}if (e.key === 'Escape') {const closeButton = modal.querySelector('[data-dismiss="modal"]');if (closeButton) {closeButton.click();}}});};document.querySelectorAll('.modal').forEach(trapFocusInModal);const announcePageChange = function() {const pageTitle = document.title;const liveRegion = document.getElementById('navbar-live-region');if (liveRegion) {liveRegion.textContent = 'Navigated to ' + pageTitle;setTimeout(function() {liveRegion.textContent = '';},3000);}};window.addEventListener('popstate',announcePageChange);document.addEventListener('navigation:complete',announcePageChange);document.addEventListener('shown.bs.modal',function(e) {const modal = e.target;const focusableElement = modal.querySelector( 'a[href],button:not([disabled]),textarea,input[type="text"],input[type="search"],input[type="radio"],input[type="checkbox"],select' );if (focusableElement) {focusableElement.focus();}trapFocusInModal(modal);});document.addEventListener('hidden.bs.modal',function(e) {const trigger = document.querySelector('[data-target="#' + e.target.id + '"]') || document.querySelector('[href="#' + e.target.id + '"]');if (trigger) {trigger.focus();}});const observer = new MutationObserver(function(mutations) {mutations.forEach(function(mutation) {if (mutation.type === 'childList') {mutation.addedNodes.forEach(function(node) {if (node.nodeType === 1) {const dropdownMenus = node.querySelectorAll ? node.querySelectorAll('.dropdown-menu') :[];dropdownMenus.forEach(function(menu) {if (!menu.getAttribute('role')) {menu.setAttribute('role','menu');}menu.querySelectorAll('.dropdown-item').forEach(function(item) {if (!item.getAttribute('role')) {item.setAttribute('role','menuitem');}});});const dropdownToggles = node.querySelectorAll ? node.querySelectorAll('.dropdown-toggle') :[];dropdownToggles.forEach(function(toggle) {if (!toggle.getAttribute('aria-haspopup')) {toggle.setAttribute('aria-haspopup','true');}if (!toggle.getAttribute('aria-expanded')) {toggle.setAttribute('aria-expanded','false');}});}});}});});observer.observe(document.body,{childList:true,subtree:true });});function initScrollEffect() {const navbar = document.querySelector('.navbar-custom');if (!navbar) return;let lastScrollTop = 0;let scrollTimeout;window.addEventListener('scroll',function() {const scrollTop = window.pageYOffset || document.documentElement.scrollTop;clearTimeout(scrollTimeout);if (scrollTop > 50) {navbar.classList.add('navbar-scrolled');}else {navbar.classList.remove('navbar-scrolled');}if (window.innerWidth <= 767) {if (scrollTop > lastScrollTop && scrollTop > 100) {navbar.style.transform = 'translateY(-100%)';}else {navbar.style.transform = 'translateY(0)';}}else {navbar.style.transform = 'translateY(0)';}lastScrollTop = scrollTop;scrollTimeout = setTimeout(() => {if (window.innerWidth <= 767) {navbar.style.transform = 'translateY(0)';}},1000);},{passive:true });}function enhanceAccessibility() {const skipLink = document.createElement('a');skipLink.href = '#main-content';skipLink.textContent = 'Skip to main content';skipLink.className = 'sr-only sr-only-focusable';skipLink.style.cssText = ` position:absolute;top:-40px;left:6px;width:1px;height:1px;padding:8px 16px;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0;z-index:9999;background:#2FA4E7;color:white;text-decoration:none;border-radius:4px;`;skipLink.addEventListener('focus',function() {this.style.cssText += ` position:absolute;top:6px;left:6px;width:auto;height:auto;clip:auto;overflow:visible;`;});skipLink.addEventListener('blur',function() {this.style.cssText = ` position:absolute;top:-40px;left:6px;width:1px;height:1px;padding:8px 16px;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0;z-index:9999;background:#2FA4E7;color:white;text-decoration:none;border-radius:4px;`;});document.body.insertBefore(skipLink,document.body.firstChild);const dropdownToggles = document.querySelectorAll('.dropdown-toggle');dropdownToggles.forEach(toggle => {if (!toggle.getAttribute('aria-haspopup')) {toggle.setAttribute('aria-haspopup','true');}if (!toggle.getAttribute('aria-expanded')) {toggle.setAttribute('aria-expanded','false');}toggle.addEventListener('keydown',function(e) {if (e.key === 'Enter' || e.key === ' ') {e.preventDefault();this.click();}});});const formControls = document.querySelectorAll('.form-control');formControls.forEach(control => {const label = document.querySelector(`label[for="${control.id}"]`);if (!label && control.id) {const parentLabel = control.closest('label');if (parentLabel) {parentLabel.setAttribute('for',control.id);}}if (control.hasAttribute('required')) {const label = document.querySelector(`label[for="${control.id}"]`);if (label && !label.querySelector('.text-danger')) {const required = document.createElement('span');required.className = 'text-danger';required.textContent = ' *';required.setAttribute('aria-label','required');label.appendChild(required);}}});}function enhanceKeyboardNavigation() {const navbarCollapse = document.querySelector('.navbar-collapse');const navbarToggler = document.querySelector('.navbar-toggler');if (navbarCollapse && navbarToggler) {document.addEventListener('keydown',function(e) {if (window.innerWidth < 768 && navbarCollapse.classList.contains('show')) {const focusableElements = navbarCollapse.querySelectorAll( 'a[href],button:not([disabled]),input:not([disabled]),select:not([disabled]),textarea:not([disabled]),[tabindex]:not([tabindex="-1"])' );const firstElement = focusableElements[0];const lastElement = focusableElements[focusableElements.length - 1];if (e.key === 'Tab') {if (e.shiftKey) {if (document.activeElement === firstElement) {e.preventDefault();lastElement.focus();}}else {if (document.activeElement === lastElement) {e.preventDefault();firstElement.focus();}}}if (e.key === 'Escape') {navbarToggler.click();navbarToggler.focus();}}});}const dropdownMenus = document.querySelectorAll('.dropdown-menu');dropdownMenus.forEach(menu => {const menuItems = menu.querySelectorAll('.dropdown-item:not(.disabled)');menuItems.forEach((item,index) => {item.addEventListener('keydown',function(e) {let nextIndex;switch (e.key) {case 'ArrowDown':e.preventDefault();nextIndex = (index + 1) % menuItems.length;menuItems[nextIndex].focus();break;case 'ArrowUp':e.preventDefault();nextIndex = (index - 1 + menuItems.length) % menuItems.length;menuItems[nextIndex].focus();break;case 'Home':e.preventDefault();menuItems[0].focus();break;case 'End':e.preventDefault();menuItems[menuItems.length - 1].focus();break;case 'Escape':e.preventDefault();const toggle = menu.previousElementSibling;if (toggle) {menu.classList.remove('show');toggle.setAttribute('aria-expanded','false');toggle.focus();}break;}});});});}function debounce(func,wait,immediate) {let timeout;return function executedFunction() {const context = this;const args = arguments;const later = function() {timeout = null;if (!immediate) func.apply(context,args);};const callNow = immediate && !timeout;clearTimeout(timeout);timeout = setTimeout(later,wait);if (callNow) func.apply(context,args);};}function initEnhancedTouchSupport() {const interactiveElements = document.querySelectorAll('a,button,.btn,.nav-link,.dropdown-item');interactiveElements.forEach(element => {element.addEventListener('touchstart',function() {this.classList.add('touch-feedback');},{passive:true });element.addEventListener('touchend',function() {setTimeout(() => {this.classList.remove('touch-feedback');},150);},{passive:true });element.addEventListener('touchcancel',function() {this.classList.remove('touch-feedback');},{passive:true });});const buttons = document.querySelectorAll('button,.btn');buttons.forEach(button => {button.addEventListener('touchend',function(e) {e.preventDefault();this.click();});});}if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {document.addEventListener('DOMContentLoaded',initEnhancedTouchSupport);}/ ** * Initialize scroll effect for navbar * Added as part of task 7.1:Improve mobile navigation experience */ function initScrollEffect() {const navbar = document.querySelector('.navbar-custom');if (!navbar) return;let lastScrollTop = 0;let scrollTimeout;window.addEventListener('scroll',function() {const scrollTop = window.pageYOffset || document.documentElement.scrollTop;clearTimeout(scrollTimeout);if (scrollTop > 50) {navbar.classList.add('navbar-scrolled');}else {navbar.classList.remove('navbar-scrolled');}if (window.innerWidth < 768) {if (scrollTop > lastScrollTop && scrollTop > 100) {navbar.style.transform = 'translateY(-100%)';}else {navbar.style.transform = 'translateY(0)';}}else {navbar.style.transform = '';}lastScrollTop = scrollTop;scrollTimeout = setTimeout(() => {if (window.innerWidth < 768) {navbar.style.transform = 'translateY(0)';}},150);});}function enhanceAccessibility() {if (!document.querySelector('.skip-link')) {const skipLink = document.createElement('a');skipLink.href = '#main-content';skipLink.className = 'skip-link sr-only sr-only-focusable';skipLink.textContent = 'Skip to main content';document.body.insertBefore(skipLink,document.body.firstChild);}const dropdownToggles = document.querySelectorAll('.dropdown-toggle');dropdownToggles.forEach(toggle => {if (!toggle.getAttribute('aria-haspopup')) {toggle.setAttribute('aria-haspopup','true');}if (!toggle.getAttribute('aria-expanded')) {toggle.setAttribute('aria-expanded','false');}toggle.addEventListener('keydown',function(e) {if (e.key === 'Enter' || e.key === ' ') {e.preventDefault();this.click();}});});const formControls = document.querySelectorAll('.form-control');formControls.forEach(control => {const label = document.querySelector(`label[for="${control.id}"]`);if (!label && control.getAttribute('placeholder')) {control.setAttribute('aria-label',control.getAttribute('placeholder'));}});}function enhanceKeyboardNavigation() {const navbarCollapse = document.querySelector('.navbar-collapse');const navbarToggler = document.querySelector('.navbar-toggler');if (navbarCollapse && navbarToggler) {document.addEventListener('keydown',function(e) {if (e.key === 'Escape' && navbarCollapse.classList.contains('show')) {navbarToggler.click();navbarToggler.focus();}if (navbarCollapse.classList.contains('show') && window.innerWidth < 768) {const focusableElements = navbarCollapse.querySelectorAll( 'a,button,input,textarea,select,[tabindex]:not([tabindex="-1"])' );if (focusableElements.length > 0) {const firstElement = focusableElements[0];const lastElement = focusableElements[focusableElements.length - 1];if (e.key === 'Tab') {if (e.shiftKey) {if (document.activeElement === firstElement) {e.preventDefault();lastElement.focus();}}else {if (document.activeElement === lastElement) {e.preventDefault();firstElement.focus();}}}}}});}const dropdownMenus = document.querySelectorAll('.dropdown-menu');dropdownMenus.forEach(menu => {const items = menu.querySelectorAll('.dropdown-item');items.forEach((item,index) => {item.addEventListener('keydown',function(e) {let nextIndex;switch (e.key) {case 'ArrowDown':e.preventDefault();nextIndex = (index + 1) % items.length;items[nextIndex].focus();break;case 'ArrowUp':e.preventDefault();nextIndex = (index - 1 + items.length) % items.length;items[nextIndex].focus();break;case 'Home':e.preventDefault();items[0].focus();break;case 'End':e.preventDefault();items[items.length - 1].focus();break;}});});});}document.addEventListener('DOMContentLoaded',function() {initNavbar();});