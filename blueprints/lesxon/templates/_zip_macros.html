{% from 'components/ui_components.html' import card, icon_card, button, input_group, select_group, checkbox_group, alert, table, badge %}

{% macro create_zip_content() %}
<form id="createZipForm">
    {{ input_group(
        name="zip_name",
        label="Nombre del Archivo ZIP",
        type="text",
        placeholder="mi_archivo.zip",
        icon="fas fa-file-archive",
        id="zip_name",
        help_text="Sin extensión .zip"
    ) }}
    
    {{ select_group(
        name="compression_level",
        label="Nivel de Compresión",
        options=[
            {"value": "0", "text": "Sin compresión (más rápido)"},
            {"value": "6", "text": "Compresión estándar"},
            {"value": "9", "text": "Máxima compresión (más lento)"}
        ],
        selected="6",
        icon="fas fa-compress",
        id="compression_level"
    ) }}
    
    <div class="form-group">
        <label class="form-label">
            <i class="fas fa-folder mr-2"></i>
            Seleccionar Archivos
        </label>
        <div class="border rounded p-3" style="max-height: 200px; overflow-y: auto;">
            {{ checkbox_group(
                name="files[]",
                label="btcusdt_klines.csv (2.5 MB)",
                value="btcusdt_klines.csv",
                id="file1"
            ) }}
            {{ checkbox_group(
                name="files[]",
                label="ethusdt_trades.json (1.8 MB)",
                value="ethusdt_trades.json",
                id="file2"
            ) }}
            {{ checkbox_group(
                name="files[]",
                label="adausdt_ticker.xlsx (0.5 MB)",
                value="adausdt_ticker.xlsx",
                id="file3"
            ) }}
            {{ checkbox_group(
                name="files[]",
                label="market_data.csv (3.2 MB)",
                value="market_data.csv",
                id="file4"
            ) }}
        </div>
        <small class="form-text text-muted">Selecciona los archivos que deseas incluir en el ZIP</small>
    </div>
    
    {{ checkbox_group(
        name="password_protect",
        label="Proteger con contraseña",
        id="password_protect",
        class="mb-3"
    ) }}
    
    <div id="passwordField" style="display: none;">
        {{ input_group(
            name="zip_password",
            label="Contraseña",
            type="password",
            placeholder="Ingresa una contraseña segura",
            icon="fas fa-lock",
            id="zip_password"
        ) }}
    </div>
    
    <div class="form-group">
        {{ button(
            text="Crear ZIP",
            variant="success",
            icon="fas fa-plus",
            class="btn-block",
            onclick="createZip()"
        ) }}
    </div>
    
    <div class="form-group mb-0">
        {{ button(
            text="Seleccionar Todo",
            variant="outline-secondary",
            icon="fas fa-check-square",
            class="btn-block",
            onclick="selectAllFiles()"
        ) }}
    </div>
</form>
{% endmacro %}

{% macro zip_files_content() %}
{{ table(
    headers=["Archivo", "Tamaño", "Fecha Creación", "Archivos", "Acciones"],
    rows=[
        [
            '<i class="fas fa-file-archive text-primary mr-2"></i>datos_enero_2024.zip',
            "8.5 MB",
            "2024-01-15 14:30",
            "15 archivos",
            '<div class="btn-group btn-group-sm" role="group">' +
            '<button class="btn btn-outline-primary" onclick="downloadZip(\'datos_enero_2024.zip\')" title="Descargar"><i class="fas fa-download"></i></button>' +
            '<button class="btn btn-outline-info" onclick="viewZipContents(\'datos_enero_2024.zip\')" title="Ver contenido"><i class="fas fa-eye"></i></button>' +
            '<button class="btn btn-outline-warning" onclick="extractZip(\'datos_enero_2024.zip\')" title="Extraer"><i class="fas fa-expand-arrows-alt"></i></button>' +
            '<button class="btn btn-outline-danger" onclick="deleteZip(\'datos_enero_2024.zip\')" title="Eliminar"><i class="fas fa-trash"></i></button>' +
            '</div>'
        ],
        [
            '<i class="fas fa-file-archive text-primary mr-2"></i>backup_diciembre_2023.zip',
            "12.3 MB",
            "2024-01-10 09:15",
            "23 archivos",
            '<div class="btn-group btn-group-sm" role="group">' +
            '<button class="btn btn-outline-primary" onclick="downloadZip(\'backup_diciembre_2023.zip\')" title="Descargar"><i class="fas fa-download"></i></button>' +
            '<button class="btn btn-outline-info" onclick="viewZipContents(\'backup_diciembre_2023.zip\')" title="Ver contenido"><i class="fas fa-eye"></i></button>' +
            '<button class="btn btn-outline-warning" onclick="extractZip(\'backup_diciembre_2023.zip\')" title="Extraer"><i class="fas fa-expand-arrows-alt"></i></button>' +
            '<button class="btn btn-outline-danger" onclick="deleteZip(\'backup_diciembre_2023.zip\')" title="Eliminar"><i class="fas fa-trash"></i></button>' +
            '</div>'
        ],
        [
            '<i class="fas fa-file-archive text-warning mr-2"></i>temp_export.zip',
            "1.2 MB",
            "2024-01-14 16:45",
            "3 archivos",
            '<div class="btn-group btn-group-sm" role="group">' +
            '<button class="btn btn-outline-primary" onclick="downloadZip(\'temp_export.zip\')" title="Descargar"><i class="fas fa-download"></i></button>' +
            '<button class="btn btn-outline-info" onclick="viewZipContents(\'temp_export.zip\')" title="Ver contenido"><i class="fas fa-eye"></i></button>' +
            '<button class="btn btn-outline-warning" onclick="extractZip(\'temp_export.zip\')" title="Extraer"><i class="fas fa-expand-arrows-alt"></i></button>' +
            '<button class="btn btn-outline-danger" onclick="deleteZip(\'temp_export.zip\')" title="Eliminar"><i class="fas fa-trash"></i></button>' +
            '</div>'
        ]
    ],
    striped=true,
    hover=true,
    responsive=true
) }}

<div class="d-flex justify-content-between align-items-center mt-3">
    <small class="text-muted">Total: 21.0 MB en 3 archivos ZIP</small>
    <div>
        {{ button(
            text="Limpiar Archivos Temporales",
            variant="outline-warning",
            size="sm",
            icon="fas fa-broom",
            onclick="cleanTempFiles()"
        ) }}
    </div>
</div>
{% endmacro %}

{% macro extract_manage_content() %}
<div class="row">
    <div class="col-md-6">
        <h6><i class="fas fa-upload text-success mr-2"></i>Subir Archivo ZIP</h6>
        <div class="border border-2 border-dashed rounded p-4 text-center mb-3 bg-light" 
             style="border-style: dashed !important; border-color: #6c757d !important; transition: all 0.3s ease;"
             onmouseover="this.style.borderColor='#007bff'; this.style.backgroundColor='#f8f9fa'"
             onmouseout="this.style.borderColor='#6c757d'; this.style.backgroundColor='#f8f9fa'">
            <div class="mb-3">
                <i class="fas fa-cloud-upload-alt fa-4x text-primary mb-2"></i>
            </div>
            <h6 class="text-dark mb-2">Subir Archivo ZIP</h6>
            <p class="text-muted mb-3">Arrastra un archivo ZIP aquí o haz clic para seleccionar</p>
            <input type="file" class="d-none" id="zipFileInput" accept=".zip,.rar,.7z" onchange="handleZipUpload(this)">
            {{ button(
                text="Seleccionar Archivo",
                variant="primary",
                icon="fas fa-folder-open",
                onclick="document.getElementById('zipFileInput').click()"
            ) }}
            <div class="mt-2">
                <small class="text-muted">Formatos soportados: ZIP, RAR, 7Z (máx. 100MB)</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <h6><i class="fas fa-cogs text-info mr-2"></i>Herramientas de Gestión</h6>
        <div class="d-grid gap-2">
            {{ button(
                text="Verificar Integridad",
                variant="info",
                icon="fas fa-shield-alt",
                class="mb-2",
                onclick="verifyIntegrity()"
            ) }}
            {{ button(
                text="Reparar Archivos",
                variant="warning",
                icon="fas fa-tools",
                class="mb-2",
                onclick="repairFiles()"
            ) }}
            {{ button(
                text="Estadísticas de Uso",
                variant="secondary",
                icon="fas fa-chart-pie",
                onclick="showStats()"
            ) }}
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        {{ alert(
            message="<strong>Consejo:</strong> Los archivos ZIP con contraseña requieren autenticación adicional para ser extraídos.",
            type="info",
            icon="fas fa-info-circle"
        ) }}
    </div>
</div>
{% endmacro %}

</rewritten_file>